<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Escala música 06-2025</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #fafafa;
    padding: 20px;
    color: #222;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
  }
  .loader {
    border: 6px solid #eee;
    border-top: 6px solid #444;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 40px auto;
  }
  @keyframes spin {
    0% {transform: rotate(0deg);}
    100% {transform: rotate(360deg);}
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    display: none;
  }
  th, td {
    padding: 10px 8px;
    text-align: center;
    border-bottom: 1px solid #eee;
    font-size: 14px;
  }
  th {
    background-color: #222;
    color: white;
    position: sticky;
    top: 0;
    z-index: 1;
  }
  tr:last-child td {
    border-bottom: none;
  }
  /* Coluna vazia do cabeçalho: só espaço visual, sem borda */
  th.empty {
    background: transparent;
    border: none;
    pointer-events: none;
  }
  @keyframes fadeInUp {
    from {opacity: 0; transform: translateY(10px);}
    to {opacity: 1; transform: translateY(0);}
  }
  tr.animada {
    opacity: 0;
    animation: fadeInUp 0.3s ease forwards;
  }
  /* Layout filtros */
  #filtros {
    max-width: 1200px;
    margin: 0 auto 20px;
    background: white;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 1px 8px rgb(0 0 0 / 0.1);
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.4s ease;
  }
  #filtros input[type="text"],
  #filtros input[type="date"],
  #filtros select {
    width: 180px;
    margin: 6px 8px 6px 0;
    padding: 8px 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
    color: #333;
    transition: border-color 0.3s ease;
  }
  #filtros input[type="text"]::placeholder,
  #filtros input[type="date"]::placeholder {
    color: #999;
    font-style: italic;
  }
  #filtros input[type="text"]:focus,
  #filtros input[type="date"]:focus,
  #filtros select:focus {
    border-color: #5a9bd5;
    outline: none;
  }
  #btnToggleFiltros {
    background: #5a9bd5;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 2px 8px rgb(90 155 213 / 0.3);
    transition: background-color 0.3s ease;
    max-width: 200px;
    margin: 0 auto 10px;
    display: block;
  }
  #btnToggleFiltros:hover {
    background: #4477cc;
  }
  /* Responsivo */
  @media (max-width: 768px) {
    table, thead, tbody, th, td, tr {
      display: block;
    }
    thead {
      display: none;
    }
    tr {
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: white;
      padding: 12px;
    }
    td {
      text-align: left;
      padding: 6px 10px;
      font-size: 13px;
      border: none;
      position: relative;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    td::before {
      content: attr(data-label);
      font-weight: bold;
      display: block;
      color: #555;
      margin-bottom: 6px;
    }
    #filtros input[type="text"],
    #filtros input[type="date"],
    #filtros select {
      width: 100%;
      margin: 6px 0;
    }
  }
</style>
</head>
<body>
<h1>Escala de Louvor</h1>

<button id="btnToggleFiltros" aria-expanded="false" aria-controls="filtros" aria-label="Mostrar filtros da tabela">Mostrar filtros</button>

<div id="filtros" role="search" aria-label="Filtros para busca na tabela" style="display:none; max-height: 0; padding: 0 20px;">
  <input type="date" id="filter-data" aria-label="Filtro por data" placeholder="Data" />
  <select id="filter-diaSemana" aria-label="Filtro por dia da semana" title="Dia da semana">
    <option value="">Dia Semana (Todos)</option>
    <option value="domingo">domingo</option>
    <option value="segunda-feira">segunda-feira</option>
    <option value="terça-feira">terça-feira</option>
    <option value="quarta-feira">quarta-feira</option>
    <option value="quinta-feira">quinta-feira</option>
    <option value="sexta-feira">sexta-feira</option>
    <option value="sábado">sábado</option>
    <option value="sábado/tarde">sábado/tarde</option>
    <option value="batismo">batismo</option>
  </select>
  <input type="text" id="filter-regente" placeholder="Regente" aria-label="Filtro por regente" />
  <input type="text" id="filter-acomp" placeholder="Acompanhamento" aria-label="Filtro por acompanhamento" />
  <input type="text" id="filter-equipeLouvor" placeholder="Equipe Louvor" aria-label="Filtro por equipe louvor" />
  <input type="text" id="filter-msgMuscal" placeholder="Mensagem Musical" aria-label="Filtro por mensagem musical" />
  <input type="text" id="filter-pregador" placeholder="Pregador" aria-label="Filtro por pregador" />
  <input type="text" id="filter-anciao" placeholder="Ancião" aria-label="Filtro por ancião" />
  <input type="text" id="filter-audiovisual" placeholder="Audiovisual" aria-label="Filtro por audiovisual" />
  <input type="text" id="filter-suporte" placeholder="Suporte" aria-label="Filtro por suporte" />
  <input type="text" id="filter-obs" placeholder="Observações" aria-label="Filtro por observações" />
</div>

<div class="loader" id="carregando"></div>

<table id="tabela-escala" aria-label="Tabela com escala de louvor">
  <thead>
    <tr>
      <th>DATA</th>
      <th>DIA SEMANA</th>
      <th>REGENTE</th>
      <th>ACOMP</th>
      <th>EQUIPE LOUVOR</th>
      <th>MENSAGEM MUSCAL</th>
      <th class="empty"></th> <!-- coluna vazia -->
      <th>PREGADOR</th>
      <th>ANCIÃO</th>
      <th>AUDIOVISUAL</th>
      <th>SUPORTE</th>
      <th>OBS</th>
    </tr>
  </thead>
  <tbody>
    <!-- Conteúdo gerado via JS -->
  </tbody>
</table>

<script>
  const btnToggle = document.getElementById('btnToggleFiltros');
  const filtrosDiv = document.getElementById('filtros');
  const tabela = document.getElementById('tabela-escala');
  const carregando = document.getElementById('carregando');

  btnToggle.addEventListener('click', () => {
    const aberto = filtrosDiv.style.display === 'block';
    if (aberto) {
      // fechar
      filtrosDiv.style.maxHeight = '0';
      filtrosDiv.style.padding = '0 20px';
      setTimeout(() => filtrosDiv.style.display = 'none', 400);
      btnToggle.textContent = 'Mostrar filtros';
      btnToggle.setAttribute('aria-expanded', 'false');
    } else {
      // abrir
      filtrosDiv.style.display = 'block';
      filtrosDiv.style.maxHeight = filtrosDiv.scrollHeight + 'px';
      filtrosDiv.style.padding = '15px 20px';
      btnToggle.textContent = 'Ocultar filtros';
      btnToggle.setAttribute('aria-expanded', 'true');
    }
  });

  async function carregarCSV() {
    try {
      const resposta = await fetch('atual.csv', { headers: { 'Content-Type': 'text/plain' } });
      if (!resposta.ok) throw new Error('Arquivo não encontrado');
      const texto = await resposta.text();

      const linhas = texto.trim().split('\n').filter(l => l.trim() !== '');

      const cabecalhos = [
        'DATA',
        'DIA SEMANA',
        'REGENTE',
        'ACOMP',
        'EQUIPE LOUVOR',
        'MENSAGEM MUSCAL',
        '',              // coluna vazia extra no meio
        'PREGADOR',
        'ANCIÃO',
        'AUDIOVISUAL',
        'SUPORTE',
        'OBS'
      ];

      const corpoTabela = tabela.querySelector('tbody');
      corpoTabela.innerHTML = '';

      linhas.forEach((linha, i) => {
        // separa por vírgula, respeitando as aspas duplas
        const colunas = linha.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)
          .map(c => c.replace(/^"|"$/g, '').trim());

        while (colunas.length < cabecalhos.length) {
          colunas.push('');
        }

        const tr = document.createElement('tr');
        colunas.forEach((col, idx) => {
          const td = document.createElement('td');
          td.textContent = col;
          td.setAttribute('data-label', cabecalhos[idx] || '');
          tr.appendChild(td);
        });

        tr.classList.add('animada');
        tr.style.animationDelay = `${i * 0.05}s`;
        corpoTabela.appendChild(tr);
      });

      carregando.style.display = 'none';
      tabela.style.display = 'table';

      adicionarFiltros();
    } catch (e) {
      console.error('Erro ao carregar CSV:', e);
      carregando.style.display = 'none';
      const pErro = document.createElement('p');
      pErro.style.color = 'red';
      pErro.style.textAlign = 'center';
      pErro.textContent = 'Erro ao carregar os dados. Verifique se "atual.csv" está na mesma pasta.';
      document.body.appendChild(pErro);
    }
  }

  function adicionarFiltros() {
    const filtros = {
      data: document.getElementById('filter-data'),
      diaSemana: document.getElementById('filter-diaSemana'),
      regente: document.getElementById('filter-regente'),
      acomp: document.getElementById('filter-acomp'),
      equipeLouvor: document.getElementById('filter-equipeLouvor'),
      msgMuscal: document.getElementById('filter-msgMuscal'),
      pregador: document.getElementById('filter-pregador'),
      anciao: document.getElementById('filter-anciao'),
      audiovisual: document.getElementById('filter-audiovisual'),
      suporte: document.getElementById('filter-suporte'),
      obs: document.getElementById('filter-obs')
    };

    Object.values(filtros).forEach(input => {
      input.addEventListener('input', filtrarTabela);
      input.addEventListener('change', filtrarTabela);
    });

    function filtrarTabela() {
      const trs = tabela.querySelectorAll('tbody tr');

      trs.forEach(tr => {
        const tds = tr.querySelectorAll('td');

        // pega os textos das colunas da linha
        const linha = {
          data: tds[0].textContent.toLowerCase(),
          diaSemana: tds[1].textContent.toLowerCase(),
          regente: tds[2].textContent.toLowerCase(),
          acomp: tds[3].textContent.toLowerCase(),
          equipeLouvor: tds[4].textContent.toLowerCase(),
          msgMuscal: tds[5].textContent.toLowerCase(),
          // 6 = coluna vazia, ignorar
          pregador: tds[7].textContent.toLowerCase(),
          anciao: tds[8].textContent.toLowerCase(),
          audiovisual: tds[9].textContent.toLowerCase(),
          suporte: tds[10].textContent.toLowerCase(),
          obs: tds[11].textContent.toLowerCase()
        };

        // filtros
        const filtroData = filtros.data.value; // yyyy-mm-dd
        const filtroDia = filtros.diaSemana.value.toLowerCase();
        const filtroRegente = filtros.regente.value.toLowerCase();
        const filtroAcomp = filtros.acomp.value.toLowerCase();
        const filtroEquipe = filtros.equipeLouvor.value.toLowerCase();
        const filtroMsg = filtros.msgMuscal.value.toLowerCase();
        const filtroPregador = filtros.pregador.value.toLowerCase();
        const filtroAnciao = filtros.anciao.value.toLowerCase();
        const filtroAudiovisual = filtros.audiovisual.value.toLowerCase();
        const filtroSuporte = filtros.suporte.value.toLowerCase();
        const filtroObs = filtros.obs.value.toLowerCase();

        // converter data da linha para yyyy-mm-dd para comparar
        let linhaData = '';
        if (linha.data) {
          // converter dd/mm/yyyy para yyyy-mm-dd
          const parts = linha.data.split('/');
          if(parts.length === 3) {
            linhaData = `${parts[2]}-${parts[1].padStart(2,'0')}-${parts[0].padStart(2,'0')}`;
          }
        }

        // checar cada filtro (se filtro vazio, ignora)
        const condicoes = [
          filtroData ? linhaData === filtroData : true,
          filtroDia ? linha.diaSemana.includes(filtroDia) : true,
          filtroRegente ? linha.regente.includes(filtroRegente) : true,
          filtroAcomp ? linha.acomp.includes(filtroAcomp) : true,
          filtroEquipe ? linha.equipeLouvor.includes(filtroEquipe) : true,
          filtroMsg ? linha.msgMuscal.includes(filtroMsg) : true,
          filtroPregador ? linha.pregador.includes(filtroPregador) : true,
          filtroAnciao ? linha.anciao.includes(filtroAnciao) : true,
          filtroAudiovisual ? linha.audiovisual.includes(filtroAudiovisual) : true,
          filtroSuporte ? linha.suporte.includes(filtroSuporte) : true,
          filtroObs ? linha.obs.includes(filtroObs) : true,
        ];

        if (condicoes.every(c => c)) {
          tr.style.display = '';
        } else {
          tr.style.display = 'none';
        }
      });
    }
  }

  carregarCSV();
</script>
</body>
</html>
